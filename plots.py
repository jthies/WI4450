import numpy as np
import matplotlib.pyplot as plt

# %% 3. Convergence behaviour of Conjugate Gradient method
# error = np.array([4.682e+09,1.192e+09,5.543e+08,3.384e+08,2.562e+08,3.115e+08,2.402e+08,2.21e+08,2.558e+08,2.675e+08,2.441e+08,2.547e+08,2.456e+08,
#                   2.793e+08,2.281e+08,2.858e+08,2.481e+08,2.524e+08,2.838e+08,2.316e+08,2.816e+08,2.44e+08,2.472e+08,2.623e+08,2.241e+08,2.535e+08,
#                   2.235e+08,2.244e+08,2.263e+08,2.015e+08,2.153e+08,1.926e+08,1.927e+08,1.877e+08,1.724e+08,1.775e+08,1.606e+08,1.607e+08,
#                   1.533e+08,1.439e+08,1.452e+08,1.323e+08,1.328e+08,1.253e+08,1.193e+08,1.192e+08,1.091e+08,1.099e+08,1.032e+08,9.895e+07,
#                   9.852e+07,9.039e+07,9.13e+07,8.562e+07,8.24e+07,8.204e+07,7.538e+07,7.622e+07,7.16e+07,6.891e+07,6.874e+07,6.321e+07,6.391e+07,
#                   6.024e+07,5.785e+07,5.786e+07,5.326e+07,5.376e+07,5.092e+07,4.873e+07,4.888e+07,4.506e+07,4.534e+07,4.319e+07,4.117e+07,
#                   4.139e+07,3.823e+07,3.831e+07,3.672e+07,3.485e+07,3.511e+07,3.251e+07,3.242e+07,3.126e+07,2.955e+07,2.979e+07,2.768e+07,
#                   2.744e+07,2.662e+07,2.507e+07,2.527e+07,2.357e+07,2.322e+07,2.265e+07,2.126e+07,2.139e+07,2.004e+07,1.961e+07,1.922e+07,
#                   1.799e+07,1.806e+07,1.698e+07,1.649e+07,1.619e+07,1.507e+07,1.492e+07,1.383e+07,1.288e+07,1.197e+07,1.02e+07,9.012e+06,
#                   7.421e+06,6.137e+06,5.294e+06,4.406e+06,3.978e+06,3.503e+06,3.1e+06,2.882e+06,2.577e+06,2.484e+06,2.365e+06,2.239e+06,2.236e+06,
#                   2.139e+06,2.167e+06,2.167e+06,2.125e+06,2.198e+06,2.164e+06,2.208e+06,2.229e+06,2.188e+06,2.256e+06,2.199e+06,2.191e+06,
#                   2.186e+06,2.1e+06,2.103e+06,2.003e+06,1.942e+06,1.895e+06,1.768e+06,1.725e+06,1.618e+06,1.526e+06,1.463e+06,1.345e+06,1.29e+06,
#                   1.197e+06,1.113e+06,1.062e+06,9.685e+05,9.204e+05,8.561e+05,7.909e+05,7.529e+05,6.882e+05,6.521e+05,6.081e+05,5.613e+05,
#                   5.362e+05,4.91e+05,4.642e+05,4.359e+05,4.011e+05,3.831e+05,3.524e+05,3.315e+05,3.12e+05,2.868e+05,2.732e+05,2.513e+05,2.352e+05,
#                   2.214e+05,2.025e+05,1.921e+05,1.766e+05,1.638e+05,1.54e+05,1.401e+05,1.318e+05,1.211e+05,1.113e+05,1.042e+05,9.442e+04,
#                   8.807e+04,8.078e+04,7.362e+04,6.87e+04,6.194e+04,5.739e+04,5.263e+04,4.755e+04,4.436e+04,3.975e+04,3.658e+04,3.375e+04,
#                   3.049e+04,2.849e+04,2.557e+04,2.384e+04,2.187e+04,1.998e+04,1.875e+04,1.711e+04,1.603e+04,1.495e+04,1.389e+04,1.313e+04,
#                   1.23e+04,1.15e+04,1.093e+04,9980,9237,8097,6809,5417,3921,2659,1690,1032,682.3,512.9,513.5,697,1180,2196,3430,3551,2271,
#                   1011,438.2,240.3,223.3,357.5,657.5,846.4,573.4,269.3,162,169.7,275,369.2,254.6,129.4,89.32,110.8,165.4,143.2,78.13,52.14,
#                   61.49,88.68,73.33,41.05,31.55,40.52,48.98,32.45,19.89,20.89,27.79,23.56,13.9,12,16.23,15.7,9.768,7.853,10.04,10.61,6.795,
#                   5.452,6.994,7.205,4.814,4.051,5.214,5.205,3.469,3.306,4.31,3.82,2.725,2.908,3.678,2.913,2.255,2.785,3.052,2.219,2.067,2.627,
#                   2.397,1.779,1.991,2.338,1.738,1.53,1.885,1.707,1.269,1.363,1.534,1.14,1.005,1.217,1.033,0.7831,0.8758,0.8865,0.6476,0.6155,
#                   0.6923,0.5307,0.4207,0.4707,0.3988,0.2841,0.2937,0.2794,0.1955,0.1775,0.1847,0.1373,0.1131,0.1263,0.1059,0.08493,0.09942,
#                   0.09724,0.07921,0.08953,0.09336,0.07122,0.06651,0.06322,0.04139,0.0309,0.02847,0.01986,0.01579,0.018,0.01651,0.01501,0.01756,
#                   0.01505,0.01082,0.01009,0.008505,0.006427,0.006868,0.007057,0.00537,0.005025,0.004506,0.003165,0.003089,0.003291,0.002617,
#                   0.00245,0.002347,0.001747,0.001666,0.001839,0.001514,0.001361,0.001343,0.001026,0.0009368,0.001007,0.0007903,0.0006794,
#                   0.0006882,0.0005428,0.0004896,0.0004972,0.000375,0.0003271,0.0003362,0.0002688,0.0002311,0.0002211,0.0001732,0.000149,
#                   0.0001493,0.0001119,9.272e-05,9.468e-05,7.294e-05,6.539e-05,6.272e-05,4.792e-05,4.431e-05,4.272e-05,3.319e-05,2.962e-05,
#                   2.984e-05,2.345e-05,2.155e-05,2.046e-05,1.634e-05,1.587e-05,1.535e-05,1.207e-05,1.185e-05,1.168e-05,9.278e-06,9.317e-06,
#                   8.725e-06,7.2e-06,7.125e-06,6.297e-06,5.055e-06,5.127e-06,4.294e-06,3.427e-06,3.38e-06,2.799e-06,2.249e-06,2.139e-06,1.724e-06,
#                   1.445e-06,1.393e-06,1.103e-06,9.895e-07,9.785e-07,7.902e-07,7.306e-07,7.496e-07,6.204e-07,6.271e-07,6.357e-07,5.647e-07,
#                   5.906e-07,5.836e-07,5.059e-07,5.329e-07,4.623e-07,3.839e-07,3.692e-07,2.9e-07,2.245e-07,2.029e-07,1.506e-07,1.218e-07,
#                   1.085e-07,8.501e-08,7.563e-08,7.196e-08,5.937e-08,5.898e-08,5.5e-08,4.503e-08,4.281e-08,3.656e-08,2.791e-08,2.647e-08,
#                   2.195e-08,1.904e-08,1.965e-08,1.727e-08,1.583e-08,1.479e-08,1.105e-08,9.417e-09,8.044e-09,6.424e-09,6.456e-09,6.045e-09,
#                   5.068e-09,4.701e-09,3.662e-09,2.848e-09,2.727e-09,2.39e-09,2.182e-09,2.009e-09,1.497e-09,1.198e-09,1.051e-09,8.719e-10,
#                   8.863e-10,7.965e-10,6.274e-10,5.738e-10,4.927e-10,4.506e-10,4.815e-10,4.058e-10,3.526e-10,3.39e-10,2.929e-10,2.96e-10,
#                   2.733e-10,2.141e-10,1.951e-10,1.74e-10,1.57e-10,1.531e-10,1.195e-10])

# error = np.sqrt(error)
# fig, ax = plt.subplots()
# ax.plot(error)
# ax.set_yscale('log')
# ax.set_ylabel("||b-Lx||_2")
# ax.set_xlabel("iterations")
# plt.show()

# %% 4. Strong scalability
# n_threads = np.array([1,2,4,8,12,16,20,24,28,32])
# axpby = 0.00194967/np.array([0.00194967,0.00105889, 0.000972084, 0.000583146, 0.000342023, 0.000281533, 0.000194611, 0.000166814, 0.000131861, 0.000257515])
# dot = 0.00237746/np.array([0.00237746,0.00125333, 0.000943063, 0.000533878, 0.00035669, 0.000343699, 0.000417351, 0.000409869, 0.000294867, 0.000486861])
# init = 0.0009395/np.array([0.0009395,0.000486643, 0.000480544, 0.000381199, 0.000242575, 0.000234286, 0.000199319, 0.000171488, 0.000271275, 0.000491309])
# stencil = 0.31347/np.array([0.31347, 0.144049, 0.0704993, 0.0387975, 0.0277458, 0.0234714, 0.0189203, 0.0166922, 0.0155139, 0.0157857])

# fig, ax = plt.subplots()
# ax.plot(n_threads, axpby, label='axpby')
# ax.plot(n_threads, dot, label='dot')
# ax.plot(n_threads, init, label='init')
# ax.plot(n_threads, stencil, label ='stencil')
# ax.legend()
# ax.set_ylabel("speedup")
# ax.set_xlabel("number of threads")
# plt.show()

# %% 4. Weak scalability
fig = plt.figure()
ax1 = fig.add_subplot(111)
ax2 = ax1.twiny()

n_threads = np.array([6,12,24,48])
axpby = 0.00958853/np.array([0.00958853, 0.0113111, 0.0143877, 0.0352071])*n_threads
dot = 0.00625024/np.array([0.00625024, 0.00729878, 0.00868705,  0.0265751])*n_threads
init = 0.00629553/np.array([0.00629553, 0.00954938, 0.0169318, 0.0387363])*n_threads
stencil = 0.899871/np.array([0.899871, 0.789457, 0.835696, 1.17005])*n_threads

ax1.plot(n_threads, axpby, label='axpby')
ax1.plot(n_threads, dot, label='dot')
ax1.plot(n_threads, init, label='init')
ax1.plot(n_threads, stencil, label ='stencil')

ax1.set_xlabel("number of threads")
ax1.set_ylabel("speedup")
ax1.legend()

new_tick_locations = np.array([6,12,24,48])

ax2.set_xlim(ax1.get_xlim())
ax2.set_xticks(new_tick_locations)
ax2.set_xticklabels(["256","323","406","512"]) #["6", "12", "24", "48"])
ax2.set_xlabel("problem size")
plt.show()